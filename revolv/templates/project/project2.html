{% extends "base/base.html" %}
{% load staticfiles %}
{% load humanize %}

{% load comments %}
{% block head %}
    <script type="text/javascript">
        window.PARTIAL_COMPLETENESS = {{ project.partial_completeness_as_js }};
    </script>
    <script src="{% static 'js/base/homeAnimations.js' %}?version={{ version_number }}"></script>
    <style>
        input:focus:invalid {
            box-shadow: 0 0 5px 1px red;
        }

        input:invalid {
            box-shadow: 0 0 5px 1px red;
        }

        .input-group {
            position: relative !important;
            display: table !important;
            border-collapse:separate !important;
        }
        .body {
            font-size: 2rem !important;
        }
        #project-button:hover {
            background:#FCAA3A !important;
        }

        .plyr {
            width:80% !important;
        }
        
    </style>
    
    <link href="{% static 'css/project.css' %}?version={{ version_number }}" rel="stylesheet"/>
{% endblock %}
{% block title %}Project | {% endblock %}
{% block body %}

<!-- Start -->
{% include "project/confirm_modal.html" %}
{% if is_draft_mode == True %}
    <div class="draft-mode-div">
        <span class="draft-mode-title">Pending.</span>
        <span class="draft-mode-detail-text">This project is currently pending approval. Thank you!</span>
    </div>
{% endif %}

{% if project.org_name == 'SSF' %}
<main role="main" class="container-fluid">
    <div class="container-fluid campaign-post-header" 
    style="background-image: linear-gradient(to bottom, rgba(170, 246, 252, 0.52), rgba(39, 39, 92, 0.73)), url('{{MEDIA_URL}}{{project.cover_photo.url }}' ); 
    background-position: top center;
    background-repeat: no-repeat;
    height: 100%;
    background-size: cover;
    height: 100%;
    width: 100%;
    background-color: #999;">
      <div class="row text-center" style="height: 500px; z-index: 2; position: relative;">
        <div class="col hero-text align-self-end mb-5">
          <h1 class="text-light fw-300">{{ project.title }}</h1>
        </div>
      </div>
        <div class="col-md-2 col-md-offset-2">
        {% if request.user.is_authenticated %}
        {% ifequal project.created_by_user|stringformat:"s" request.user.username %}
        <a href="/project/{{project.id}}/edit" style=" color: white;">
        <button id="project-button" style="
        height: 48px;
        line-height: 48px;
        background-color: #ff8a00;
        transition: background-color .15s linear;
        text-transform: uppercase;
        letter-spacing: .1em;
        border-radius: 4px;
        border: 0;
        font-size: 15px;
        padding: 0 20px;
        font-weight: 500;
        display: inline-block;
        color: #fff;
        margin-bottom:40px;
        "> Edit Campaign
        </button>
    </a>




{% endifequal %}
{% endif %}
        </div>
    </div>
    <div class="container-fluid" id="campaign-body">
      <div class="row justify-content-center align-items-center">
        <div class="col-sm-12 co-md-10 col-lg-10">
          <div class="row">
            <div class="col-sm-12 col-md-4 pr-4">

              <div class="campaign-col">
                <div class="title-container">  
                  <h1><sup>$</sup> <span class="bold">{{ project.amount_donated|floatformat:"0"|intcomma }}</span> <small>Raised</small></h1>
                </div>
                <div class="campaign-text">
                  <ul class="progress-text">
                    <li class="current-progress">{{ project.percent_complete }}%</li>
                    <li class="target-progress">${{ project.amount_donated |floatformat:"0"|intcomma}}</li>
                  </ul>
                  <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: {{ project.percent_complete }}%;" aria-valuenow="{{ project.percent_complete }}" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                  <div class="w-100"></div>
                  <h3 class="fw-700 mt-3 mb-0">{{ project.get_statistic_for_project|floatformat:"0"|intcomma }}</h3>
                  <h5 class="fw-700 my-0">lbs CO2 Avoided</h5>
                  <div class="module-box payment-module">
                    <div class="inputs">
                        <div class="input-group">
                            <label for="value fw-700" style="font-weight:700;">Donation to the campaign</label>
                            <div class="input-group-prepend">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control donation-field" step="any"
                                        value="50" min="0" name="value">
                            </div>
                        </div>
                        <div class="input-group mt-3">
                            <label for="total" style="font-weight:700;">Total</label>
                            <div class="input-group-prepend">
                                <span class="input-group-text">$</span>
                                <input type="number" disabled="" class="form-control" step="1"
                                        value="10" name="total">
                            </div>
                        </div>
                        <div class="input-group" >
                            <form action="{% url 'project:stripe_payment' pk=project.pk %}"
                                    method="POST" id="ipad">
                                {% csrf_token %}
                                <input type="hidden" name="amount_cents"
                                        value="{{ donation_level.amount }}">
                                <input name="metadata" value="1.00" type="hidden">
                                <button type="submit" class="stripe-button-el"
                                        style="visibility: visible;">
                                    <span style="display: block; min-height: 30px;">DONATE</span>
                                </button>
                            </form>
                        </div>
                    </div>
                    <form action="{% url 'project:stripe_payment' pk=project.pk %}" method="POST"
                            id="phone">
                        {% csrf_token %}
                        <input type="hidden" name="amount_cents" value="{{ donation_level.amount }}">
                        <input name="metadata" value="1.00" type="hidden">
                        <button type="submit" class="stripe-button-el" style="visibility: visible; background:transparent; border: none; outline:none;">
     
                            <a class="btn btn-orange btn-me btn-arrow-white mt-4">Back this project</a>
                        </button>
                    </form>
                  </div>                  
                </div>
              </div>
                            
              <div class="updates-col">
                <h3 class="blue-text my-3 ml-5">Updates</h3>
                <div class="line-section pb-2">
                    <div class="line-left"></div>
                </div>

    
            <!-- renders the full object of comments 
            {% render_comment_list for object %}
             -->

            {% get_comment_list for object  as commenter_list %}
            {% if commenter_list.count == 0  %}
            <div class="updates-inner-col mt-4">
                <p> There are currently no updates.. </p>   
            </div>
            {% endif %}
            {% for commenter in commenter_list reversed %}
            <div class="updates-inner-col mt-4">
                <span class="meta-date">{{ commenter.submit_date }}</span>
                <p> {{ commenter.comment }} </p>   
            </div>
      

            {% endfor %}


            {% if request.user.is_authenticated %}
            {% ifequal project.created_by_user|stringformat:"s" request.user.username %}

            {% get_comment_form for project as form %}
            
            <form action="{% comment_form_target %}" method="POST">
                    {% csrf_token %}
                    {% for field in form %}
                    {% if field.is_hidden %}
                    {{ field }}
                    {% endif %}
                    {% endfor %}
                    <input type="hidden" name="name" value="{{ user }}" />
                    <input type="hidden" name="next" value="/project/{{project.id}}/" />
                    <input type="text" name="honeypot" size="64" style="display: none;" />
                    <textarea id="id_comment" rows="1" cols="40"
                              name="comment" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;
                          
                              width: 100%;"></textarea>
                    <input id="project-button" type="submit" name="submit" class="submit-post" value="Post" 
                    style="height: 48px;
                    line-height: 48px;
                    background-color: #ff8a00;
                    transition: background-color .15s linear;
                    text-transform: uppercase;
                    letter-spacing: .1em;
                    border-radius: 4px;
                    border: 0;
                    font-size: 15px;
                    padding: 0 20px;
                    font-weight: 500;
                    display: inline-block;
                    color: #fff;
                    margin-bottom: 40px;" />
            </form>
            
            {% endifequal %}
            {% endif %}




            </div>

            <div class="donate-icon-col mb-4">
                <a href="/project/create-sub">
                <div class="donate-icon-wrapper"><img src="../../../static/images/blog-monthly-img/donate-icon.png"></div>
                <div class="donate-txt-wrapper">
                    <h2>Create</h2>
                    <p>your own fundraiser</p>
                </div>
                </a>
            </div>
  
        </div>



            <div class="col-sm-12 col-md-8 campaign-body-text pl-4">
              <h2 class="orange-text fw-300">Light up the {{ project.title }}</h2>
              <h6 class="fw-500">About the campaign</h6>

              <p class="content-gold-silver content_sec">{{ project.description|safe  }}</p> 
              <p class="content-gold-silver content_sec">{{ project.org_about|safe }}</p> 

              <div class="plyr-video" style="width:50% !important;" data-plyr-provider="youtube" data-plyr-embed-id="fCrs2eASgFg"></div>
              
              <h6 class="mt-3"> Make sure to share the campaign on social media. <span style='font-size:2rem;'>&#128516;</span></h6>
              <div class="">
                <div class="">
                    <div id="share-buttons">
                        <a href="http://www.facebook.com/sharer.php?u=https://www.re-volv.org/project/{{ project.project_url }}"
                            onclick="window.open('http://www.facebook.com/sharer.php?u=https://www.re-volv.org/project/{{ project.project_url }}','popup','width=600,height=600'); return false;"   
                            target="_blank" class="social-circle facebook">
                            <i class="fab fa-facebook-square mx-2 display-4" style="color:#140869;"></i>
                         </a>
                         <a href="https://www.twitter.com/share?url=https://www.re-volv.org/project/{{ project.project_url }}&amp;text=Spread solar and change lives. Learn more about people-funded renewable energy here:&amp;"
                            target="_blank" class="social-circle twitter">
                            <i class="fab fa-twitter-square mx-2 display-4" style="color:#140869;"></i>
                         </a>
                    </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid" id="share-section">
      <div class="row justify-content-center align-items-center">
        <div class="col-sm-12 co-md-12 col-lg-12 text-center">
          <h1 class="text-white fw-300 mb-5">Follow us on social media</h1>
          <ul class="sharing-icons">
            <li><a href="https://www.facebook.com/solarseedfund/" rel="noopener noreferrer" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
            <li><a href="https://twitter.com/RE_volv" rel="noopener noreferrer" target="_blank"><i class="fab fa-twitter"></i></a></li>
            <li><a href="https://www.youtube.com/user/REvolvSolarSeedFund" rel="noopener noreferrer" target="_blank"><i class="fab fa-youtube"></i></a></li>
            <li><a href="https://www.instagram.com/re.volv/" rel="noopener noreferrer" target="_blank"><i class="fab fa-instagram"></i></a></li>
          </ul>
        </div>
      </div>
    </div>



  </main><!-- /.container -->



  {% elif project.org_name == 'SUBSF' %}
  <main role="main" class="container-fluid">

      <div class="container-fluid campaign-post-header" 
      style="background-image:linear-gradient(to bottom, rgba(170, 246, 252, 0.52), rgba(39, 39, 92, 0.73)), url('/media/{{ cover_main }}' ); 
      background-position: top center;
      background-repeat: no-repeat;
      height: 100%;
      background-size: cover;
      height: 100%;
      width: 100%;
      background-color: #999;">
        <div class="row text-center" style="height:100%; z-index: 2; position: relative;">
          <div class="col hero-text align-self-end mb-5">
            <h1 class="fundraise-header-title">
                <div class="fundraise-user" style="margin-top:7rem;">
                <img src="{{MEDIA_URL}}{{project.profile_picture.url }}">
                </div>
                <h1 class="text-light fw-300 " style="margin-top:240px;">{{ project.title }}</h1>
            </div>
          </div>
          <div class="col-md-2 col-md-offset-2">
                {% if request.user.is_authenticated %}
                {% ifequal project.created_by_user|stringformat:"s" request.user.username %}
                <a href="/project/{{project.id}}/edit-sub" style=" color: white;">
                <button id="project-button" style="
                height: 48px;
                line-height: 48px;
                background-color: #ff8a00;
                transition: background-color .15s linear;
                text-transform: uppercase;
                letter-spacing: .1em;
                border-radius: 4px;
                border: 0;
                font-size: 15px;
                padding: 0 20px;
                font-weight: 500;
                display: inline-block;
                color: #fff;
                margin-bottom:40px;
                "> Edit Sub Campaign
                </button>
            </a>
        
        {% endifequal %}
        {% endif %}
                </div>
        </div>

          

      <div class="container-fluid" id="campaign-body">
        <div class="row justify-content-center align-items-center">
          <div class="col-sm-12 co-md-10 col-lg-10">
            <div class="row">
              <div class="col-sm-12 col-md-4 pr-4">
  
                <div class="campaign-col">
                  <div class="title-container">  
                    <h1><sup>$</sup> <span class="bold">{{ project.amount_donated|floatformat:"0"|intcomma }}</span> <small>Raised</small></h1>
                  </div>
                  <div class="campaign-text">
                    <ul class="progress-text">
                      <li class="current-progress">{{ project.percent_complete }}%</li>
                      <li class="target-progress">${{ project.amount_donated |floatformat:"0"|intcomma}}</li>
                    </ul>
                    <div class="progress">
                      <div class="progress-bar" role="progressbar" style="width: {{ project.percent_complete }}%;" aria-valuenow="{{ project.percent_complete }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="w-100"></div>
                    <h3 class="fw-700 mt-3 mb-0">{{ project.get_statistic_for_project|floatformat:"0"|intcomma }}</h3>
                    <h5 class="fw-700 my-0">lbs CO2 Avoided</h5>
                    <div class="module-box payment-module">
                      <div class="inputs">
                          <div class="input-group">
                              <label for="value fw-700" style="font-weight:700;">Donation to the campaign</label>
                              <div class="input-group-prepend">
                                  <span class="input-group-text">$</span>
                                  <input type="number" class="form-control donation-field" step="any"
                                          value="50" min="0" name="value">
                              </div>
                          </div>
                          <div class="input-group">
                              <label for="total" style="font-weight:700;">Total</label>
                              <div class="input-group-prepend">
                                  <span class="input-group-text">$</span>
                                  <input type="number" disabled="" class="form-control" step="1"
                                          value="10" name="total">
                              </div>
                          </div>
                          <div class="input-group" >
                              <form action="{% url 'project:stripe_payment' pk=project.pk %}"
                                      method="POST" id="ipad">
                                  {% csrf_token %}
                                  <input type="hidden" name="amount_cents"
                                          value="{{ donation_level.amount }}">
                                  <input name="metadata" value="1.00" type="hidden">
                                  <button type="submit" class="stripe-button-el"
                                          style="visibility: visible;">
                                      <span style="display: block; min-height: 30px;">DONATE</span>
                                  </button>
                              </form>
                          </div>
                      </div>
                      <form action="{% url 'project:stripe_payment' pk=project.pk %}" method="POST"
                              id="phone">
                          {% csrf_token %}
                          <input type="hidden" name="amount_cents" value="{{ donation_level.amount }}">
                          <input name="metadata" value="1.00" type="hidden">
                          <button type="submit" class="stripe-button-el" style="visibility: visible; background:transparent; border: none; outline:none;">
       
                              <a class="btn btn-orange btn-me btn-arrow-white mt-4">Back this project</a>
                          </button>
                      </form>
                    </div>                  
                  </div>
                </div>
                              
                <div class="updates-col">
                  <h3 class="blue-text my-3 ml-5">Updates</h3>
                  <div class="line-section pb-2">
                      <div class="line-left"></div>
                  </div>
  
      
              <!-- renders the full object of comments 
              {% render_comment_list for object %}
               -->
  
              {% get_comment_list for object  as commenter_list %}
              {% if commenter_list.count == 0  %}
              <div class="updates-inner-col mt-4">
                  <p> There are currently no updates.. </p>   
              </div>
              {% endif %}
              {% for commenter in commenter_list reversed %}
              <div class="updates-inner-col mt-4">
                  <span class="meta-date">{{ commenter.submit_date }}</span>
                  <p> {{ commenter.comment }} </p>   
              </div>
        
  
              {% endfor %}
  
  
              {% if request.user.is_authenticated %}
              {% ifequal project.created_by_user|stringformat:"s" request.user.username %}
  
              {% get_comment_form for project as form %}
              
              <form action="{% comment_form_target %}" method="POST">
                      {% csrf_token %}
                      {% for field in form %}
                      {% if field.is_hidden %}
                      {{ field }}
                      {% endif %}
                      {% endfor %}
                      <input type="hidden" name="name" value="{{ user }}" />
                      <input type="hidden" name="next" value="/project/{{project.id}}/" />
                      <input type="text" name="honeypot" size="64" style="display: none;" />
                      <textarea id="id_comment" rows="1" cols="40"
                                name="comment" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;
                            
                                width: 100%;"></textarea>
                      <input id="project-button" type="submit" name="submit" class="submit-post" value="Post" 
                      style="height: 48px;
                      line-height: 48px;
                      background-color: #ff8a00;
                      transition: background-color .15s linear;
                      text-transform: uppercase;
                      letter-spacing: .1em;
                      border-radius: 4px;
                      border: 0;
                      font-size: 15px;
                      padding: 0 20px;
                      font-weight: 500;
                      display: inline-block;
                      color: #fff;
                      margin-bottom: 40px;" />
              </form>
              
              {% endifequal %}
              {% endif %}
  
  
  
  
              </div>
    
              </div>
  
  
  
              <div class="col-sm-12 col-md-8 campaign-body-text pl-4">
                <h2 class="orange-text fw-300">{{ project.title }}</h2>
                <h6 class="fw-500">About the sub campaign</h6>
    
                <p class="content-gold-silver content_sec">{{ project.description|safe }}</p> 
                <p class="content-gold-silver content_sec">{{ project.org_about|safe }}</p> 

                <div class="plyr-video" data-plyr-provider="youtube" data-plyr-embed-id="fCrs2eASgFg"></div>
  
                <h6 class="mt-3"> Make sure to share the campaign on social media. <span style='font-size:2rem;'>&#128516;</span></h6>
                <div class="">
                  <div class="">
                      <div id="share-buttons">
                          <a href="http://www.facebook.com/sharer.php?u=https://www.re-volv.org/project/{{ project.project_url }}"
                              onclick="window.open('http://www.facebook.com/sharer.php?u=https://www.re-volv.org/project/{{ project.project_url }}','popup','width=600,height=600'); return false;"   
                              target="_blank" class="social-circle facebook">
                              <i class="fab fa-facebook-square mx-2 display-4" style="color:#140869;"></i>
                           </a>
                           <a href="https://www.twitter.com/share?url=https://www.re-volv.org/project/{{ project.project_url }}&amp;text=Spread solar and change lives. Learn more about people-funded renewable energy here:&amp;"
                              target="_blank" class="social-circle twitter">
                              <i class="fab fa-twitter-square mx-2 display-4" style="color:#140869;"></i>
                           </a>
                      </div>
                  </div>
                </div>  
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container-fluid" id="share-section">
        <div class="row justify-content-center align-items-center">
          <div class="col-sm-12 co-md-12 col-lg-12 text-center">
            <h1 class="text-white fw-300 mb-5">Follow us on social media</h1>
            <ul class="sharing-icons">
              <li><a href="https://www.facebook.com/solarseedfund/" rel="noopener noreferrer" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
              <li><a href="https://twitter.com/RE_volv" rel="noopener noreferrer" target="_blank"><i class="fab fa-twitter"></i></a></li>
              <li><a href="https://www.youtube.com/user/REvolvSolarSeedFund" rel="noopener noreferrer" target="_blank"><i class="fab fa-youtube"></i></a></li>
              <li><a href="https://www.instagram.com/re.volv/" rel="noopener noreferrer" target="_blank"><i class="fab fa-instagram"></i></a></li>
            </ul>
          </div>
        </div>
      </div>
  
  
  
    </main><!-- /.container -->
  
  




  {% else %}


  <div class="container-fluid application-header" id="top-section" style="background-position: center !important; height: 250px;">
        <div class="row text-center" style="height: 200px !important; margin: 0 auto;">
            <div class="col hero-text align-self-end">
            <h4 class="text-light">  </h4>
            </div>
        </div>
        </div>
    <div class="container-fluid scroll-section" id="scroll-section">
        <div class="scroll-icon">
        <img class="scroll-arrow bouncing" src="../../../static/images/nonprofit-img/scroll-icon.png">
        </div>
    </div>
    <div id="reinvest-spinner"><img src="/static/images/gif/revolv-loader.gif" alt="reinvestment is loading"></div>
    {% include "project/confirm_modal.html" %}
    {% if is_draft_mode == True %}
        <div class="draft-mode-div">
            <span class="draft-mode-title">Pending.</span>
            <span class="draft-mode-detail-text">This project is currently pending approval. Thank you!</span>
        </div>
    {% endif %}
    <div class="contents project-details-contents after-header">
    {% if project_matching_donor %}
        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 title-matching-donor">
            <div class="title-blue-border title-yellow-border">ALL DONATIONS ARE NOW BEING MATCHED!
            </div>
        </div>
    {% endif %}
    <div class="details-active-project-module">
    <div class="container">
        <div class="col-md-12 col-xs-12">
            <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12 social-share-project active-pr-button">
                {% if project.status_display|upper == 'ACTIVE' %}
                    <div class="project-status-desktop-top title-active-project pull-right">
                        <p>Share this campaign</p>
                        <div id="share-buttons">
                            <!-- Buffer -->
                            <a href="mailto:?Subject=Simple Share Buttons&amp;Body=I%20saw%20this%20and%20thought%20of%20sharing%20this!%20 https://www.re-volv.org/project/{{ project.project_url }}"
                               class="social-circle envelope">
                                <i class="fa fa-envelope"></i>
                            </a>
                            <a href="http://www.facebook.com/sharer.php?u=https://www.re-volv.org/project/{{ project.project_url }}"
                               onclick="window.open('http://www.facebook.com/sharer.php?u=https://www.re-volv.org/project/{{ project.project_url }}','popup','width=600,height=600'); return false;"   
                               target="_blank" class="social-circle facebook">
                                <i class="fa fa-facebook"></i>
                            </a>
                            <a href="https://www.twitter.com/share?url=https://www.re-volv.org/{{ project.project_url }}&amp;text=Spread solar and change lives. Learn more about people-funded renewable energy here:&amp;"
                               target="_blank" class="social-circle twitter">
                                <i class="fa fa-twitter"></i>
                            </a>
                            <a href="https://www.instagram.com/re.volv/" class="social-circle instagram"
                               target="_blank">
                                <i class="fa fa-instagram"></i>
                            </a>
                            <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.re-volv.org/project/{{ project.project_url }}"
                               onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.re-volv.org/project/{{ project.project_url }}','popup','width=600,height=600'); return false;"    
                               target="_blank" class="social-circle linkedin">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        </div>
                    </div>
                    <div class="project-status-mobile title-blue-border title-active-project pull-right">{{ project.status_display|upper }}
                        PROJECT
                    </div>
                {% else %}
                    <div class="title-blue-border title-active-project pull-right">{{ project.status_display|upper }}
                        PROJECT
                    </div>
                {% endif %}
            </div>
            <div class="col-lg-8 col-md-7 col-sm-12 col-xs-12">
                <h1 class="title-h1 title-right-new">{{ project.title }}</h1>
            </div>
        </div>
    </div>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    {% if project.status_display|upper == 'ACTIVE' %}
        <div class="social project-status-desktop-left">
            <ul>
                <li style="background:#100084;">
                    <a href="mailto:?Subject=RE-volv campaign&amp;Body=I%20saw%20this%20and%20thought%20of%20sharing%20this!%20 https://www.re-volv.org/project/{{ project.project_url }}">Email
                        <i class="fa fa-envelope"></i></a></li>
                <li style="background:#100084;">
                    <a href="http://www.facebook.com/sharer.php?u=https://www.re-volv.org/project/{{ project.project_url }}"
                        onclick="window.open('http://www.facebook.com/sharer.php?u=https://www.re-volv.org/project/{{ project.project_url }}','popup','width=600,height=600'); return false;"   
                        target="_blank">Facebook <i class="fa fa-facebook" style="padding-right: 10px"></i></a></li>
                <li style="background:#100084;">
                    <a href="https://www.twitter.com/share?url=https://www.re-volv.org/{{ project.project_url }}&amp;text=Spread solar and change lives. Learn more about people-funded renewable energy here:&amp;"
                       target="_blank">Twitter <i class="fa fa-twitter"></i></a></li>
                <li style="background:#100084;"><a href="https://www.instagram.com/re.volv/" target="_blank">Instagram <i
                        class="fa fa-instagram"></i></a></li>
                <li style="background:#100084;">
                    <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.re-volv.org/project/{{ project.project_url }}"
                        onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.re-volv.org/project/{{ project.project_url }}','popup','width=600,height=600'); return false;"    
                        target="_blank">Linkedin <i class="fa fa-linkedin"></i></a>
                </li>
            </ul>
        </div>
    {% endif %}
    {% if request.GET.reinvestment %}
        <div class="info-section">
            <div class="container">
                <div class="video-main">
                    <div class="row">
                        <div class="video-area col-lg-8 col-md-7">
                            <div class="video" style="height:313px">
                                {% if project.video_url %}
                                    <iframe class="project_video youtube-player" allowfullscreen
                                            style="height:313px"></iframe>
                                {% endif %}
                            </div>
                        </div>

                        <div class="txt-area1 col-lg-4 col-md-5">
                            <div class="module-box payment-module">
                                <h5 class="title-h5">Reinvestment In this Project</h5>
                                <div class="back-the-project">Reinvest now to help {{ project.title }} go solar and grow
                                    the Solar Seed Fund
                                </div>
                                <div class="inputs">
                                    <form action="{% url 'project:reinvest' pk=project.pk %}" method="POST">
                                        {% csrf_token %}
                                        <div class="input-group">
                                            <label for="value">Reinvestment In this Project</label>
                                            <div class="input-group">
                                                <span class="input-group-addon">$</span>
                                                <input type="number" class="form-control" id="amt" step="0.01"
                                                       name="amount" value="{{ reinvestment_amount|floatformat:2}}"
                                                       min="0.01" max="{{ reinvestment_amount|floatformat:2}}">
                                            </div>
                                        </div>
                                        <div>
                                            <!-- Trigger the modal with a button -->
                                            <button type="submit" class="btn-reinvest" style="visibility: visible">
                                                REINVEST NOW
                                            </button>

                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="info-main">
                        <div class="blue-bar">
                            <span class="pull-left"><span
                                    class="bold">${{ project.amount_donated|floatformat:"0"|intcomma }}</span> Donated</span>
                            {% if project.is_completed %}
                                <span class="pull-right"><span class="bold">Campaign completed</span></span>
                            {% else %}
                                <span class="pull-right"><span
                                        class="bold">{{ project.days_left }}</span> Days Left</span>
                            {% endif %}
                        </div>
                        <!-- end .blue-bar -->
                        <div class="dark-blue-bar">
            <span class="pull-left actual-energy">
              <span class="bold">{{ project.get_statistic_for_project|floatformat:"0"|intcomma }}</span> lbs CO<sub>2</sub> Avoided</span><span
                                class="pull-right">
              <span class="bold">{{ donor_count }} </span> {{ settings.revolv_cms.ProjectPageSettings.donors_wording }}</span>
                        </div>
                        <div class="banner-section" style="    font-family: 'Montserrat', sans-serif;">
                            <div class="container">
                                <div class="funded-round">
                <span class="status-text">
                  <span class="round-depict"><span>OF</span> ${{ project.funding_goal|floatformat:0|intcomma }}</span>
                </span>
                                    <!-- end .status-text -->
                                    <div class="status-indicator desktop-circle">
                                        <input type="text" value="{{ project.percent_complete }}" data-min="0"
                                               data-width="210" data-height="210" data-bgcolor="#fff"
                                               data-fgcolor="#100084" data-max="100" data-readonly="true"
                                               data-thickness=".12">
                                    </div>
                                    <div class="status-indicator small-circle">
                                        <input type="text" value="{{ project.percent_complete }}" data-min="0"
                                               data-width="175" data-height="175" data-bgcolor="#fff"
                                               data-fgcolor="#100084" data-max="100" data-readonly="true"
                                               data-thickness=".13">
                                    </div>
                                    <div class="status-indicator tablet-circle">
                                        <input type="text" value="{{ project.percent_complete }}" data-min="0"
                                               data-width="152" data-height="152" data-bgcolor="#fff"
                                               data-fgcolor="#100084" data-max="100" data-readonly="true"
                                               data-thickness=".16">
                                    </div>
                                    <div class="status-indicator mobile-circle">
                                        <input type="text" value="{{ project.percent_complete }}" data-min="0"
                                               data-width="75" data-height="75" data-bgcolor="#fff"
                                               data-fgcolor="#100084" data-max="100" data-readonly="true"
                                               data-thickness=".12">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end .blue-bar -->
                    </div>
                    <!-- end .info-main -->
                    <!-- end .video-main -->
                </div>
            </div>
            <!-- end .info-section -->
        </div>
        <!-- end .details-active-project-module -->
        <div class="container">
        <div class="col-sm-12 outer-basic-silver-gold project-updates-module">
                <div class="col-xl-8 col-lg-8 col-md-12 col-12 ">
                        <div class="col-md-12">
                            <p class="content-gold-silver">{{ project.tagline }}</p>
                        </div>
                        <div class="col-md-12">
                            <p class="content-gold-silver content_sec">{{ project.description|safe }}</p>
                        </div>
                    </div>

            <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 pull-right price-tables">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="right-aside-new">
                        <aside class="right-aside">
                            {% if project_donation_levels %}
                                {% for donation_level in project_donation_levels %}
                                    <div class="module-box payment-module">
                                        <div class="value-txt" data-value="{{ donation_level.amount }}">$
                                            {{ donation_level.amount|floatformat:"0"|intcomma }}</div>
                                        <h5 class="title-h5">OUR APPRECIATION</h5>
                                        <p>{{ donation_level.description }}</p>
                                        <div class="inputs">
                                            <label for="tip_edit">Additional support for RE-volv</label>
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">$</span>
                                                <input type="number" name="tip_edit" min="0" step="any" value="7.50"
                                                       class="form-control tip_edit1">
                                                <span id="edit_value1" class="input-group-text">Edit</span>
                                            </div>
                                            <label for="total">Total</label>
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">$</span>
                                                <input type="number" name="total" value="10" step="1"
                                                       class="form-control" disabled>
                                            </div>
                                        </div>
                                        <form action="{% url 'project:stripe_payment' pk=project.pk %}" method="POST">
                                            {% csrf_token %}
                                            <input type="hidden" name="amount_cents"
                                                   value="{{ donation_level.amount }}">
                                            <input name="metadata" value="1.00" type="hidden">
                                            <button type="submit" class="stripe-button-el" style="visibility: visible;">
                                                <span style="display: block; min-height: 30px;">Donate</span>
                                            </button>
                                        </form>
                                    </div>
                                {% endfor %}
                                <!-- end .module-box -->

                            {% endif %}
                            <div class="module-box payment-module" style="display: none">
                                <h5 class="title-h5">Display NONE set here</h5>
                                <div class="back-the-project">Donate now to help {{ project.title }} go solar and grow
                                    the Solar Seed Fund
                                </div>
                                <div class="inputs">
                                    <label for="value">Donation to the project</label>
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">$</span>
                                        <input type="number" name="value" min="0" value="50" step="any"
                                               class="form-control">
                                    </div>
                                    <label for="tip_edit">Additional support for RE-volv</label>
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">$</span>
                                        <input type="number" name="tip_edit" min="0" step="any" value="7.50"
                                               class="form-control tip_edit2">
                                        <span id="edit_value2" class="input-group-text">Edit</span>
                                    </div>
                                    <label for="total">Total</label>
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">$</span>
                                        <input type="number" name="total" value="10" step="1" class="form-control"
                                               disabled>
                                    </div>
                                </div>
                                {% for level in project_donation_levels %}
                                {% endfor %}
                                <form action="{% url 'project:stripe_payment' pk=project.pk %}" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="amount_cents" value="1000">
                                    <input name="metadata" value="1.00" type="hidden">
                                    <button type="submit" class="stripe-button-el" style="visibility: visible;">
                                        <span style="display: block; min-height: 30px;">Donate</span>
                                    </button>
                                </form>
                            </div>
                            <!-- end .module-box -->
                        </aside>
                        <!-- end .list-area -->
                    </div>
                </div>
            </div>


            {% else %}
            <div class="info-section">
                <div class="container">
                    <div class="video-main">
                        <div class="row">
                            <div class="video-area col-lg-8 col-md-7">
                                <div class="video">
                                    {% if project.video_url %}
                                        <iframe class="project_video youtube-player" style="height: 468px;"
                                                allowfullscreen></iframe>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="txt-area1 col-lg-4 col-md-5">
                                <div class="module-box payment-module">
                                    <h5 class="title-h5">BACK THIS PROJECT</h5>
                                    <div class="back-the-project">Donate now to help {{ project.title }} go solar and
                                        grow the Solar Seed Fund
                                    </div>
                                    <div class="inputs">
                                        <div class="col-lg-11 col-md-8 col-sm-8 col-8" >
                                            <div class="input-group">
                                                <label for="value">Donation to the project</label>
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" class="form-control donation-field" step="any"
                                                            value="50" min="0" name="value">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-11 col-md-8 col-sm-8 col-8" >
                                            <div class="input-group">
                                                <label for="total">Total</label>
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" disabled="" class="form-control" step="1"
                                                        value="10" name="total">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <form action="{% url 'project:stripe_payment' pk=project.pk %}" method="POST"
                                          id="phone">
                                        {% csrf_token %}
                                        <input type="hidden" name="amount_cents" value="{{ donation_level.amount }}">
                                        <input name="metadata" value="1.00" type="hidden">
                                        <button type="submit" class="stripe-button-el" style="visibility: visible;">
                                            <span style="display: block; min-height: 30px;">DONATE</span>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="info-main">
                        <div class="blue-bar">
                            <span class="pull-left"><span
                                    class="bold">${{ project.amount_donated|floatformat:"0"|intcomma }}</span> Donated</span>
                            {% if project.is_completed %}
                                <span class="pull-right"><span class="bold">Campaign completed</span></span>
                            {% else %}
                                <span class="pull-right"><span
                                        class="bold">{{ project.days_left }}</span> Days Left</span>
                            {% endif %}
                        </div>
                        <!-- end .blue-bar -->
                        <div class="dark-blue-bar">
            <span class="pull-left actual-energy">
              <span class="bold">{{ project.get_statistic_for_project|floatformat:"0" |intcomma}}</span> lbs CO<sub>2</sub> Avoided</span><span
                                class="pull-right">
              <span class="bold">{{ donor_count }}</span> {{ settings.revolv_cms.ProjectPageSettings.donors_wording }}</span>
                        </div>
                        <div class="banner-section">
                            <div class="container">
                                <div class="funded-round">
                <span class="status-text">
                  <span class="round-depict"><span>OF</span> ${{ project.funding_goal|floatformat:0|intcomma }}</span>
                </span>
                                    <!-- end .status-text -->
                                    <div class="status-indicator desktop-circle">
                                        <input type="text" value="{{ project.percent_complete }}" data-min="0"
                                               data-width="210" data-height="210" data-bgcolor="#fff"
                                               data-fgcolor="#100084" data-max="100" data-readonly="true"
                                               data-thickness=".12">
                                    </div>
                                    <div class="status-indicator small-circle">
                                        <input type="text" value="{{ project.percent_complete }}" data-min="0"
                                               data-width="175" data-height="175" data-bgcolor="#fff"
                                               data-fgcolor="#100084" data-max="100" data-readonly="true"
                                               data-thickness=".13">
                                    </div>
                                    <div class="status-indicator tablet-circle">
                                        <input type="text" value="{{ project.percent_complete }}" data-min="0"
                                               data-width="152" data-height="152" data-bgcolor="#fff"
                                               data-fgcolor="#100084" data-max="100" data-readonly="true"
                                               data-thickness=".16">
                                    </div>
                                    <div class="status-indicator mobile-circle">
                                        <input type="text" value="{{ project.percent_complete }}" data-min="0"
                                               data-width="75" data-height="75" data-bgcolor="#fff"
                                               data-fgcolor="#100084" data-max="100" data-readonly="true"
                                               data-thickness=".12">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end .blue-bar -->
                    </div>
                    <!-- end .info-main -->
                    <!-- end .video-main -->
                </div>
            </div>
            <!-- end .info-section -->
        </div>
        <!-- end .details-active-project-module -->
        <div class="container">
        <div class="col-sm-12 outer-basic-silver-gold project-updates-module">
            
                <div class="col-xl-8 col-lg-8 col-md-12 col-12 ">
                        <div class="col-md-12">
                            <p class="content-gold-silver">{{ project.tagline }}</p>
                        </div>
                        <div class="col-md-12">
                            <p class="content-gold-silver content_sec">{{ project.description|safe }}</p>
                        </div>
                        <div class="col-md-12">
                            <p class="content-gold-silver content_sec">{{ project.org_about|safe }}</p>
                        </div>
                    </div>

        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 pull-right price-tables">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="right-aside-new">
                    <aside class="right-aside">
                        {% if project_donation_levels %}
                            {% for donation_level in project_donation_levels %}
                                <div class="module-box payment-module">
                                    <div class="value-txt" data-value="{{ donation_level.amount }}">$
                                        {{ donation_level.amount|floatformat:"0"|intcomma }}</div>
                                    <h5 class="title-h5">OUR APPRECIATION</h5>
                                    <p>{{ donation_level.description }}</p>
                                    <div class="inputs">
                                        <label for="tip_edit">Additional support for RE-volv</label>
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                            <input type="number" name="tip_edit" min="0" step="any" value="7.50"
                                                   class="form-control tip_edit4">
                                            <span id="edit_value4" class="input-group-text">Edit</span>
                                        </div>
                                        <label for="total">Total</label>
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                            <input type="number" name="total" value="10" step="1" class="form-control"
                                                   disabled>
                                        </div>
                                    </div>
                                    <form action="{% url 'project:stripe_payment' pk=project.pk %}" method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="amount_cents" value="{{ donation_level.amount }}">
                                        <input name="metadata" value="1.00" type="hidden">
                                        <button type="submit" class="stripe-button-el" style="visibility: visible;">
                                            <span style="display: block; min-height: 30px;">Donate</span>
                                        </button>
                                    </form>
                                </div>
                            {% endfor %}
                            <!-- end .module-box -->
                        {% endif %}
                        <!-- Perks -->    
                   
                        <!-- end .module-box -->
                    </aside>
                    <!-- end .list-area -->
                </div>
            </div>
        </div>
    {% endif %}
<div class="main-area col-lg-8 col-md-8 col-sm-12 col-xs-12">
    {% if updates|length > 0 %}
        <h2 class="title-blue-border title-project-updates pull-right">PROJECT UPDATES</h2>
        <div class="clearfix">
        </div>
        <div class="list-area">
            {% for update in updates %}
                <div class="row">
                    <div class="left-date">
                        <span class="date-txt">{{ update.date|date:"o" }}</span>
                        <span class="month-txt">{{ update.date|date:"M"|upper }}</span>
                    </div>
                    <div class="main-info">
                        {{ update.update_text|safe }}
                        <ul class="social-ul">
                            <li>
                                <a href="#" class="btn-icon-gray">
                                    <i class="icon-fb icons"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="btn-icon-gray">
                                    <i class="icon-tw icons"></i>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="btn-icon-gray">
                                    <i class="icon-gg icons"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- end .row -->
            {% endfor %}
        </div>
    {% endif %}
    <!-- end .list-area -->
    <div class="venue-area venue-area-left pull-left">
        <h2 class="title-blue-border title-venue pull-left">VENUE</h2>
        <div class="clearfix">
        </div>
        <div class="venue-map" id="map-canvas"></div>
        <div class="venue-bottom">
            <h4 class="title-h4">{{ project.title }}</h4>
            <p>
                <span>{{ project.location_street }}</span>
                <span>{{ project.location_city_state_zip }}</span>
            </p>
        </div>
    </div>
    <!-- end .venue-area -->
</div>
</div>
</div>

<div class="clearfix"></div>
<!-- tabs start here -->
<div class="donors-module">
    <div class="mains-tabs">
        <nav class="tab-index">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-sm-6">
                        <a href="javascript:;" class="active">DONORS</a>
                    </div>
                </div>
            </div>
            <!-- end .row -->
        </nav>
        <!-- end .nav -->
        <div class="tab-content">
            <div class="container">
                <div class="tab-content-section active">
                    <div class="row">
                        {% if project.get_anonymous_donors_count %}
                            <div class="col-md-6">
                                <div class="info-box">
                                    <h4 class="title-h4">Anonymous({{ project.get_anonymous_donors_count }})</h4>
                                </div>
                            </div>
                        {% endif %}
                        {% for donor in project.total_donors_user %}
                            <div class="col-md-6">
                                <div class="info-box">
                                    <h4 class="title-h4">{{ donor.user.get_username }}</h4>
                                </div>
                            </div>
                        {% endfor %}
                        <!-- end .col-md-6 -->
                    </div>
                </div>
                <!-- end .tab-gold -->
            </div>
        </div>
        <!-- end .tab-content -->
    </div>
    <!-- end .tabs -->
</div>
</div>
{% endif %}
<!-- End start -->

<!-- end .contents -->

{% endblock %}
{% block javascripts %}
    <!-- tab start here -->
    <script type="text/javascript" src="//maps.googleapis.com/maps/api/js?key={{ GOOGLEMAPS_API_KEY }}">
    </script>
    <script>

        var element = document.getElementById("navbar-section");
        element.classList.add("is-sticky");

        function setTwoNumberDecimal(event) {
            console.log("input", $("#amt").val().indexOf('.'))
            if ((pointPos = $("#amt").val().indexOf('.')) >= 0) {
                console.log("inside if")
                $("#amt").attr("maxLength", pointPos + 3);
            }
            else
                $("#amt").removeAttr("maxLength");
        }

        $('.btn-reinvest').on('click', function (e) {
            $('.btn-reinvest').prop('disabled', true);
            document.getElementById("amt").value = parseFloat(document.getElementById("amt").value).toFixed(2);
            e.preventDefault();
            if (parseFloat($("#amt").val()) > {{reinvestment_amount|floatformat:2}} || parseFloat($("#amt").val()) < 0.01 || $("#amt").val() == "") {
                toastr.options.positionClass = "toast-bottom-right";
                toastr.error('Invalid amount');
                e.stopPropagation();
                $('.btn-reinvest').prop('disabled', false);
            }
            else {
                $('#reinvest-spinner').css('display', 'flex');
                var $form = $(this).closest('form');
                $.ajax({
                    type: "POST",
                    url: '{% url 'project:reinvest' pk=project.pk %}',
                    data: $form.serializeArray(),
                    success: function (data) {
                        $('#reinvest-spinner').css('display', 'none');
                        $("#confirmModal").modal();
                        $(".modal-body p > span").text(parseFloat(document.getElementById("amt").value).toFixed(2));
                        $('.btn-reinvest').prop('disabled', false);
                    },
                    statusCode: {
                        308: function (data) {
                            window.location.reload(true);
                        }
                    },
                    error: function (data) {
                        window.location.href = "/my-portfolio/";
                    }
                });
            }
        });
    </script>
    <script>
        $(function ($) {
            var handler = StripeCheckout.configure({
                key: '{{ stripe_publishable_key }}'
                , image: '{% static "images/revolvorange.png" %}'
                , locale: 'auto'
                , name: 'RE-volv'
                , email: '{{request.user.email}}'
            });
            $(window).on('popstate', function () {
                handler.close();
            });
            $('.stripe-button-el').on('click', function (e) {
                e.preventDefault();
                var $form = $(this).closest('form');
                var serialized = $form.serializeArray();
                var endpoint = $form.attr('action');
                var amount, metadata;
                $.each(serialized, function () {
                    if (this.name === 'amount_cents') {
                        amount = this.value;
                    }
                    if (this.name === 'metadata') {
                        metadata = this.value;
                    }
                });
                if (typeof amount !== 'undefined') {
                    handler.open({
                        description: 'Donate $' + parseFloat((amount / 100).toFixed(2)).toLocaleString()
                        , amount: amount
                        , metadata: metadata
                        , token: function (token) {
                            var id = token.id;
                            var email = token.email;
                            var $id = $('<input>')
                                .attr('type', 'hidden')
                                .attr('name', 'stripeToken')
                                .val(id);
                            var $email = $('<input>')
                                .attr('type', 'hidden')
                                .attr('name', 'stripeEmail')
                                .val(email);
                            $id.appendTo($form);
                            $email.appendTo($form);
                            $form.trigger('submit');
                        }
                    });
                }
            });
        });
    </script>

    {% if project.video_url %}
        <script type="text/javascript">
            // function to extract the associated iframe embed url from the video url
            // from http://stackoverflow.com/questions/21607808/convert-a-youtube-video-url-to-embed-code
            function getEmbedUrl(url) {
                var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
                var match = url.match(regExp);
                if (match && match[2].length == 11) {
                    var video_id = match[2];
                    return "https://www.youtube.com/embed/" + video_id;
                }
                else {
                    return "error";
                }
            }

            // updates the iframe src url if youtube url is valid, otherwise hides it
            var embedUrl = getEmbedUrl("{{project.video_url}}");
            if (embedUrl === "error") {
                $(".project_video").remove();
            }
            else {
                $(".project_video").attr("src", embedUrl);
            }
        </script>
    {% endif %}
    <script type="text/javascript">
        // initializes the map based on the projects latitude and longitude, and adds the marker
        function initialize() {
            var location = {
                lat: {{ project.location_latitude }}, lng: {{ project.location_longitude }}
            };
            var mapOptions = {
                center: location,
                zoom: 18
            };
            var map = new google.maps.Map(document.getElementById('map-canvas'),
                mapOptions);
            var marker = new google.maps.Marker({
                position: location,
                map: map,
            });
        }

        google.maps.event.addDomListener(window, 'load', initialize);
    </script>

    <script type="text/javascript">
        var url_string = window.location.href;
        var url = new URL(url_string);
        var str_amount = url.searchParams.get("amount");
        var int_amount = parseFloat(str_amount);
        $(function ($) {
                $('.payment-module').each(function () {
                    $module = $(this);
                    var $value = $module.find('input[name="value"]');
                    if (!$value.length) {
                        $value = $module.find('.value-txt');
                    }
                    var $tip = $module.find('input[name="tip_edit"]');
                    var $total = $module.find('input[name="total"]');
                    var $amount = $module.find('input[name="amount_cents"]');
                    var $meta = $module.find('input[name="metadata"]');
                    var $donationAmount = $module.find('input[name="donation_amount"]');
                    var $donationTip = $module.find('input[name="donation_tip"]');

                    function update(event) {
                        var val = parseFloat($value.val() || $value.data('value'));
                        if (isNaN(val)) {
                            $value.val(0);
                            val = 0;
                        }
                        $value.val(val);
                        if ((int_amount > 0) || (!event.data.isTipEvent)) {
                            $tip.val((val * 15 / 100).toFixed(2));
                        }
                        var added = parseFloat($tip.val());
                        if (isNaN(added)) {
                            $tip.val(0);
                            added = 0;
                        }
                        $tip.val(added);
                        $amount.val(Math.round((val + added) * 100));
                        $meta.val(Math.round(added * 100));
                        $total.val((val + added).toFixed(2));
                        $donationAmount.val($value.val());
                        $donationTip.val($tip.val());
                    }

                    function prepress(e) {
                        /*
                          Prevent the user from ever entering in "-".
                        */
                        if (e.keyCode === 189 || e.keyCode === 187) {
                            e.preventDefault();
                        }
                        /*
                          If we hook this to the 'keyup' event, there's a noticeable delay
                          before the reversion takes place. This ensures that it happens
                          *almost* invisibly.
                        */
                        setTimeout(postpress.bind(this), 0);
                    }

                    function postpress() {
                        /*
                          Revert changes to inputs that take us past 2 decimal points.
                        */
                        var val = $(this).val();
                        if ((val + '').match(/^\d+\.\d\d\d+/)) {
                            $(this).val((val + '').match(/^\d+\.\d\d/)[0]);
                        }
                    }

                    if (int_amount > 0) {
                        $('.donation-field').val(int_amount);
                        var url = window.location.href.split('?')[0];
                        window.history.pushState("string", "Title", url);
                        update();
                        $(".stripe-button-el").trigger('click');
                    }
                    $value.on('keydown', prepress);
                    $tip.on('keydown', prepress);
                    $value.on('change keyup', {isTipEvent: false}, update);
                    $tip.on('change keyup mouseup mousedown', {isTipEvent: true}, update);
                    $value.trigger("change", {isTipEvent: false});
                });
            }
        );
        $("input[type='number']").css({
            "-moz-appearance": "textfield",
            "-webkit-appearance": "textfield",
            "appearance": "textfield"
        })
        $('.tip_edit1, .tip_edit2, .tip_edit3, .tip_edit4, .tip_edit5').prop('readonly', true);
        $('#edit_value1').click(function () {
            $('.tip_edit1').prop('readonly', false);
            $('.tip_edit1').focus();
            $('#edit_value1').remove()
        });
        $('#edit_value2').click(function () {
            $('.tip_edit2').prop('readonly', false);
            $('.tip_edit2').focus();
            $('#edit_value2').remove()
        });
        $('#edit_value3').click(function () {
            $('.tip_edit3').prop('readonly', false);
            $('.tip_edit3').focus();
            $('#edit_value3').remove()
        });
        $('#edit_value4').click(function () {
            $('.tip_edit4').prop('readonly', false);
            $('.tip_edit4').focus();
            $('#edit_value4').remove()
        });
        $('#edit_value5').click(function () {
            $('.tip_edit5').prop('readonly', false);
            $('.tip_edit5').focus();
            $('#edit_value5').remove()
        });
    </script>

{% endblock %}
